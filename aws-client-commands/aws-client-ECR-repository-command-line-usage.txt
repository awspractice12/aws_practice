#------------------------------------------------------------------------------------
#Login
#-----
ACCOUNT_ID=732631625641
REGION=us-east-2
REPO_NAME=ss-cloud-poc
REPO_URL=732631625641.dkr.ecr.us-east-2.amazonaws.com/ss-cloud-poc

aws ecr  --profile shibuadmin get-login-password --region $REGION | sudo docker login --username AWS --password-stdin $ACCOUNT_ID.dkr.ecr.$REGION.amazonaws.com
#------------------------------------------------------------------------------------
REPO_NAME=ss-cloud-poc
aws ecr  --profile shibuadmin delete-repository --repository-name $REPO_NAME --force
      
aws ecr  --profile shibuadmin create-repository --repository-name $REPO_NAME --image-scanning-configuration scanOnPush=false --region $REGION
        
#------------------------------------------------------------------------------------
#Re-Tag to OLD

MANIFEST=$(aws ecr batch-get-image --repository-name $REPO_NAME --image-ids imageTag=account-service-1.0 --query 'images[].imageManifest' --output text)

aws ecr --profile shibuadmin put-image --repository-name $REPO_NAME --image-tag OLD --image-manifest "$MANIFEST"

#------------------------------------------------------------------------------------
#List Images
aws ecr --profile shibuadmin describe-images --repository-name $REPO_NAME
aws ecr --profile shibuadmin describe-images --repository-name $REPO_NAME -image-ids imageTag=account-service-1.0 

#------------------------------------------------------------------------------------
#Delete Images
aws ecr --profile shibuadmin batch-delete-image --repository-name $REPO_NAME --image-ids imageTag=account-service-1.0 
aws ecr --profile shibuadmin batch-delete-image --repository-name $REPO_NAME --image-ids imageTag=customer-service-1.0 
aws ecr --profile shibuadmin batch-delete-image --repository-name $REPO_NAME --image-ids imageTag=loan-service-1.0 
aws ecr --profile shibuadmin batch-delete-image --repository-name $REPO_NAME --image-ids imageTag=db-derby-1.0 

------------------------------------------------------------------------------------

------------------------------------------------------------------------------------

------------------------------------------------------------------------------------

------------------------------------------------------------------------------------

------------------------------------------------------------------------------------

